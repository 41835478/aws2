<?php/** * Created by PhpStorm. * User: Administrator * Date: 2017/9/30 * Time: 16:35 */namespace App\Services;use App\Events\DistributionEvent;use App\Events\ThreeLevelEvent;use App\Http\Model\Order2;use App\Http\Model\User;class InvestmentService{    protected $accountService;    public function __construct(AccountRecordService $recordService)    {        $this->accountService = $recordService;    }    public function investment(User $user, Order2 $order)    {        $res = \DB::transaction(function () use ($user, $order) {            $investment = $order->investment;            if (count($investment) == 0) {                $config = Config::find(1)->value / 100; //赠送比例                $investment = $user->investments()->create([                    'order_id' => $order->id,                    'money' => $order->total_money,                    'give_money' => $order->total_money * $config,                ]);                if (count($investment) > 0) {                    event(new DistributionEvent(['level' => 1, 'user_id' => $user->id, 'money' => $order->total_money]));                    return true;                } else {                    return false;                }            } else {                return true;            }        });        if ($res) {            return true;        }        return false;    }}